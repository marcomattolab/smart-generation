<h2 class="text-2xl font-semibold mb-6">Infrastructure Pipeline</h2>

<div class="flex flex-col md:flex-row items-center justify-center mb-8">
  @for (step of pipelineSteps; track step.id; let i = $index) {
    <div class="flex items-center cursor-pointer p-2 rounded-lg transition-colors hover:bg-gray-100" [class.bg-purple-100]="activeStep() === step.id" (click)="setActiveStep(step.id)">
      <div class="flex items-center justify-center w-6 h-6 rounded-full mr-2" [ngClass]="activeStep() === step.id ? 'bg-purple-600 text-white' : 'bg-gray-300'">
        <span>&check;</span>
      </div>
      <span class="font-medium" [ngClass]="{ 'text-purple-700': activeStep() === step.id }">{{ step.name }}</span>
    </div>
    @if (i < pipelineSteps.length - 1) {
      <!-- Horizontal connector for desktop -->
      <div class="flex-grow h-0.5 bg-gray-300 mx-2 hidden md:block"></div>
      <!-- Vertical connector for mobile -->
      <div class="w-px h-6 bg-gray-300 my-1 md:hidden"></div>
    }
  }
</div>

<div class="step-options">
  @switch (activeStep()) {
    @case ('scm') {
      <div>
        <h3 class="text-xl font-semibold mb-4">Checkout SCM Options</h3>
        <div class="form-group">
          <label for="scm-flow">Git Flow</label>
          <select id="scm-flow" [ngModel]="wizardState.infrastructure().scm.flow" (change)="onScmFlowChange($event)">
            <option value="gitflow">GitFlow</option>
            <option value="trunk">Trunk Based</option>
          </select>
        </div>
        <div class="form-group">
          <label for="team-roles">Team & Roles</label>
          <input type="text" id="team-roles" [ngModel]="wizardState.infrastructure().scm.teamRoles" (change)="onTeamRolesChange($event)" placeholder="e.g., Developers, Testers">
        </div>
        <div class="form-group">
          <label for="default-reviewers">Default Reviewers</label>
          <input type="text" id="default-reviewers" [ngModel]="wizardState.infrastructure().scm.defaultReviewers" (change)="onDefaultReviewersChange($event)" placeholder="e.g., user1, user2">
        </div>
      </div>
    }
    @case ('maven') {
      <div>
        <h3 class="text-xl font-semibold mb-4">Maven Options</h3>
        <p>No options available for this step.</p>
      </div>
    }
    @case ('xray') {
      <div>
        <h3 class="text-xl font-semibold mb-4">Xray Options</h3>
        <div class="form-group checkbox-label">
          <input type="checkbox" id="vuln-scan" [ngModel]="wizardState.infrastructure().xray.vulnerabilityScan" (change)="onVulnerabilityScanChange($event)">
          <label for="vuln-scan">Scan for Vulnerabilities</label>
        </div>
        @if (wizardState.infrastructure().xray.vulnerabilityScan) {
          <div class="form-group">
            <label for="vuln-threshold">Vulnerability Threshold (%)</label>
            <input type="number" id="vuln-threshold" [ngModel]="wizardState.infrastructure().xray.vulnerabilityThreshold" (change)="onVulnerabilityThresholdChange($event)" min="0" max="100">
          </div>
        }
        <div class="form-group checkbox-label">
          <input type="checkbox" id="license-scan" [ngModel]="wizardState.infrastructure().xray.licenseScan" (change)="onLicenseScanChange($event)">
          <label for="license-scan">Scan for Licenses</label>
        </div>
      </div>
    }
    @case ('sonarqube') {
      <div>
        <h3 class="text-xl font-semibold mb-4">SonarQube Options</h3>
        <div class="form-group">
          <label for="quality-gate-fe">Quality Gate FE (%)</label>
          <input type="number" id="quality-gate-fe" [ngModel]="wizardState.infrastructure().sonarQube.qualityGateFE" (change)="onQualityGateFEChange($event)" min="0" max="100">
        </div>
        <div class="form-group">
          <label for="quality-gate-be">Quality Gate BE (%)</label>
          <input type="number" id="quality-gate-be" [ngModel]="wizardState.infrastructure().sonarQube.qualityGateBE" (change)="onQualityGateBEChange($event)" min="0" max="100">
        </div>
      </div>
    }
    @case ('deployment') {
      <div>
        <h3 class="text-xl font-semibold mb-4">Deployment Options</h3>
        <div class="form-group">
          <label for="deployment-type">Deployment Type</label>
          <select id="deployment-type" [ngModel]="wizardState.infrastructure().deployment.type" (change)="onDeploymentTypeChange($event)">
            <option value="vm">Virtual Machine</option>
            <option value="okd">OKD</option>
          </select>
        </div>
      </div>
    }
  }
</div>
