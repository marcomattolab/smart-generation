<div class="domain-step-container p-6">
  <h2 class="text-2xl font-bold mb-4">Domain Configuration</h2>

  <form [formGroup]="domainForm">
    <div formArrayName="entities">
      <div *ngFor="let entity of entities.controls; let i = index" [formGroupName]="i" class="mb-6 p-4 border rounded-lg">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold">Entity: {{ entity.get('name')?.value || 'New Entity' }}</h3>
          <button (click)="removeEntity(i)" type="button" class="text-red-500 hover:text-red-700">Remove Entity</button>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">Entity Name</label>
          <input type="text" formControlName="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
        </div>

        <h4 class="text-lg font-medium mb-2">Columns</h4>
        <div formArrayName="columns">
          <div *ngFor="let column of getColumns(entity).controls; let j = index" [formGroupName]="j" class="grid grid-cols-4 gap-4 items-center mb-2">
            <input type="text" formControlName="name" placeholder="Column Name" class="col-span-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            <input type="text" formControlName="type" placeholder="Column Type" class="col-span-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            <div class="col-span-1 flex items-center">
              <input type="checkbox" formControlName="required" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
              <label class="ml-2 block text-sm text-gray-900">Required</label>
            </div>
            <button (click)="removeColumn(i, j)" type="button" class="col-span-1 text-red-500 hover:text-red-700 justify-self-end">Remove Column</button>
          </div>
        </div>
        <button (click)="addColumn(i)" type="button" class="mt-2 text-indigo-600 hover:text-indigo-800">Add Column</button>
      </div>
    </div>
  </form>

  <button (click)="addEntity()" type="button" class="mt-4 text-indigo-600 hover:text-indigo-800">Add Entity</button>
</div>